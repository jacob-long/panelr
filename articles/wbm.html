<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="panelr">
<title>Introduction to the `panelr` package • panelr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Lato-0.4.7/font.css" rel="stylesheet">
<link href="../deps/IBM_Plex_Mono-0.4.7/font.css" rel="stylesheet">
<link href="../deps/Raleway-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the `panelr` package">
<meta property="og:description" content="panelr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">panelr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/wbm.html">
    <span class="fa fa-book"></span>
     
    Package Introduction
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/reshape.html">
    <span class="fa fa-arrows"></span>
     
    Reshaping Tutorial
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Documentation
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jacob-long/panelr">
    <span class="fa fa-github fa-lg"></span>
     
    Github
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to the `panelr` package</h1>
                        <h4 data-toc-skip class="author">Jacob A.
Long</h4>
            
            <h4 data-toc-skip class="date">2023-08-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jacob-long/panelr/blob/HEAD/vignettes/wbm.Rmd" class="external-link"><code>vignettes/wbm.Rmd</code></a></small>
      <div class="d-none name"><code>wbm.Rmd</code></div>
    </div>

    
    
<p>The <code>panelr</code> package contributes two categories of
things:</p>
<ol style="list-style-type: decimal">
<li>A <code>panel_data</code> object and some tools to create/manipulate
them.</li>
<li>A series of regression modeling functions for panel data.</li>
</ol>
<div class="section level2">
<h2 id="panel_data-frames">
<code>panel_data</code> frames<a class="anchor" aria-label="anchor" href="#panel_data-frames"></a>
</h2>
<p>Check out the other vignette for a lot of detail on how to take your
raw data and reshape it into a <code>panel_data</code> format. Here’s a
short version, using some example data provided by this package.</p>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1,151 × 28</span></span></span>
<span><span class="co">##       id  pov1 mother1 spouse1 inschool1 hours1  pov2 mother2 spouse2 inschool2</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>    22     1       0       0         1     21     0       0       0         1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>    75     0       0       0         1      8     0       0       0         1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>    92     0       0       0         1     30     0       0       0         1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>    96     0       0       0         0     19     1       1       0         0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>   141     0       0       0         1      0     0       0       0         1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>   161     0       0       0         1      0     0       0       0         1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>   220     0       0       0         1      6     0       0       0         1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>   229     0       0       0         1      0     1       0       0         1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>   236     0       0       0         1      0     0       0       0         1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>   240     0       0       0         1     18     1       0       0         1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1,141 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 18 more variables: hours2 &lt;dbl&gt;, pov3 &lt;dbl&gt;, mother3 &lt;dbl&gt;, spouse3 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   inschool3 &lt;dbl&gt;, hours3 &lt;dbl&gt;, pov4 &lt;dbl&gt;, mother4 &lt;dbl&gt;, spouse4 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   inschool4 &lt;dbl&gt;, hours4 &lt;dbl&gt;, age &lt;dbl&gt;, black &lt;dbl&gt;, pov5 &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   mother5 &lt;dbl&gt;, spouse5 &lt;dbl&gt;, inschool5 &lt;dbl&gt;, hours5 &lt;dbl&gt;</span></span></span></code></pre>
<p>These data come from a subset of young women surveyed as part of the
National Longitudinal Survey of Youth starting in 1979. The
<code>teen_poverty</code> data come in “wide” format, meaning there is
one row per respondent and each of the repeated measures is in a
separate column for each wave.</p>
<p>We need to convert this to “long” format, in which you have one row
for each respondent in each wave of the 5-wave survey. We’ll use
<code><a href="../reference/long_panel.html">long_panel()</a></code> for that.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">teen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/long_panel.html">long_panel</a></span><span class="op">(</span><span class="va">teen_poverty</span>, begin <span class="op">=</span> <span class="fl">1</span>, end <span class="op">=</span> <span class="fl">5</span>, label_location <span class="op">=</span> <span class="st">"end"</span><span class="op">)</span></span>
<span><span class="va">teen</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># Panel data:    5,755 × 9</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Entities:      id [1,151]</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Wave variable: wave [1, 2, 3, ... (5 waves)]</span></span></span>
<span><span class="co">##    id     wave   age black   pov mother spouse inschool hours</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> 22        1    16     0     1      0      0        1    21</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> 22        2    16     0     0      0      0        1    15</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> 22        3    16     0     0      0      0        1     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> 22        4    16     0     0      0      0        1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> 22        5    16     0     0      0      0        1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> 75        1    17     0     0      0      0        1     8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> 75        2    17     0     0      0      0        1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> 75        3    17     0     0      0      0        1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> 75        4    17     0     0      0      0        1     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> 75        5    17     0     1      0      0        1     0</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 5,745 more rows</span></span></span></code></pre>
<p>Now we have a <code>panel_data</code> object! It is a special version
of a <code>tibble</code>, which is itself a special kind of
<code>data.frame</code>. <code>panel_data</code> objects work very hard
to make sure you never accidentally drop the variables that are the
identifiers for each respondent and the indicators for which wave the
row corresponds to. <code>panel_data</code> objects also try to stay in
order by ID and wave.</p>
<p>Note that if your raw data are already in long format, you can use
the <code><a href="../reference/panel_data.html">panel_data()</a></code> function to convert them to
<code>panel_data</code> format.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"WageData"</span><span class="op">)</span></span>
<span><span class="va">wages</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/panel_data.html">panel_data</a></span><span class="op">(</span><span class="va">WageData</span>, id <span class="op">=</span> <span class="va">id</span>, wave <span class="op">=</span> <span class="va">t</span><span class="op">)</span></span></code></pre></div>
<p><code>panel_data</code> frames are designed to work with
<code>tidyverse</code> packages, particularly <code>dplyr</code>. When
used inside <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>, functions like <code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag()</a></code>
work properly by taking the previous value for the specific respondent.
If you ever need to do something that is easier to do with a “regular”
data frame, you can just use the <code><a href="../reference/unpanel.html">unpanel()</a></code> function to
convert the <code>panel_data</code> frame back to normal.</p>
</div>
<div class="section level2">
<h2 id="regression-models">Regression models<a class="anchor" aria-label="anchor" href="#regression-models"></a>
</h2>
<div class="section level3">
<h3 id="within-between-models">Within-between models<a class="anchor" aria-label="anchor" href="#within-between-models"></a>
</h3>
<p>The original motivation to create this package was to automate the
process of fitting “within-between” models, sometimes called
“between-within” or “hybrid” models (see Allison, 2009; Bell &amp;
Jones, 2015). These combine the benefits of what econometricians call
“fixed effects” models — robustness to time-invariant confounding chief
among them — as well as what they call “random effects” models, which
allow the inclusion of time-invariant coefficients. Within-between
models include coefficients that are identical to the fixed effects
equivalent, but the flexibility to also include the random effects and
other time-invariant predictors (this was noticed by Mundlak, 1978).
They are fit via multilevel models which allow for some other nice
possibilities like inclusion of random slopes and generalized linear
model specifications.</p>
<p>From here, I’ll give a somewhat technical description of these
models. If you just want to look at how to estimate them in R, skip
ahead to the next mini-section.</p>
<p>Note that fixed effects models can be fit using individual demeaning.
That is, you can subtract the entity’s own mean for each predictor and
the dependent variable and fit a model via OLS that is equivalent to the
so-called least squares dummy variable approach (in which dummy
variables for every entity ID are included as predictors).</p>
<p>Let’s get a bit more technical. We have entities <span class="math inline">\(i = 1, ..., n\)</span> who are measured at times
<span class="math inline">\(t = 1, ..., T\)</span>. We have as our
dependent variable <span class="math inline">\(y_{it}\)</span>, the
variable <span class="math inline">\(y\)</span> for individual <span class="math inline">\(i\)</span> at time <span class="math inline">\(t\)</span>. We have predictors that vary over time
<span class="math inline">\(x_{it}\)</span>, variables that do not vary
over time <span class="math inline">\(z_i\)</span>, and variables we did
not measure that do not vary over time <span class="math inline">\(\alpha_i\)</span> as well as random error <span class="math inline">\(\epsilon_{it}\)</span></p>
<p>The fixed effects model, then, looks like this:</p>
<p><span class="math display">\[
y_{it} = \mu_t + \beta_1x_{it} + \gamma z_i + \alpha_i + \epsilon_{it}
\]</span></p>
<p>Although <span class="math inline">\(\alpha_i\)</span> is not
observed, it can be estimated by including a dummy variable for each
<span class="math inline">\(i\)</span>. The <span class="math inline">\(\gamma\)</span> is undefined because the <span class="math inline">\(z_i\)</span> are perfectly collinear with the
<span class="math inline">\(\alpha_i\)</span> dummy variables.</p>
<p>The individual-mean-centered version of the fixed effects models is
based on calculating a mean of <span class="math inline">\(y\)</span>
and <span class="math inline">\(x\)</span> for each <span class="math inline">\(i\)</span> — so <span class="math inline">\(\bar{y_i}\)</span> and <span class="math inline">\(\bar{x_i}\)</span> and subtracting it from each
<span class="math inline">\(y_{it}\)</span> and <span class="math inline">\(x_{it}\)</span>. The model can be expressed like
this, including <span class="math inline">\(\bar{z_i}\)</span> and <span class="math inline">\(\bar{\alpha_i}\)</span> for demonstration:</p>
<p><span class="math display">\[
y_{it} - \bar{y_i} = \mu_t + \beta_1(x_{it} - \bar{x_i}) +
(z_i - \bar{z_i} = 0) +
(\alpha_i - \bar{\alpha_i} = 0) + (\epsilon_{it} - \bar{\epsilon_i})
\]</span></p>
<p>By de-meaning everything, all the time-invariant variables drop
out:</p>
<p><span class="math display">\[
y_{it} - \bar{y_i} = \mu_t + \beta_1(x_{it} - \bar{x_i}) +
(\epsilon_{it} - \bar{\epsilon_i})
\]</span></p>
<p>This is often called the “within” estimator. You can take these
de-meaned variables and fit an OLS regression and get valid estimates
(with some adjustments to the standard errors).</p>
<p>You can also do something slightly different and get the same results
with multilevel models. Take this, for example:</p>
<p><span class="math display">\[
y_{it} = \beta_{0i} + \beta_1(x_{it} - \bar{x_i}) + (\epsilon_{it} -
\bar{\epsilon_i})
\]</span></p>
<p>Where <span class="math inline">\(\beta_{0i}\)</span> is a random
intercept estimated for each <span class="math inline">\(i\)</span>.
This is equivalent to subtracting <span class="math inline">\(\bar{y_i}\)</span> in terms of the estimation of
<span class="math inline">\(\beta_1\)</span>. But in the multilevel
modeling framework, we can include those time-invariant <span class="math inline">\(z_i\)</span> as well. Conceptually, they are
basically being included in a model predicting <span class="math inline">\(\beta_{0i}\)</span>:</p>
<p><span class="math display">\[
\beta_{0i} = \beta_0 + \gamma z_i + u_{0i}
\]</span></p>
<p>Where <span class="math inline">\(u_{0i}\)</span> is the random error
of the model predicting <span class="math inline">\(\beta_{0i}\)</span>.</p>
<p>In fact, we can include the <span class="math inline">\(\bar{x_i}\)</span> in our multilevel model as well
and they are used just like the <span class="math inline">\(z_i\)</span>:</p>
<p><span class="math display">\[
\beta_{0i} = \beta_0 + \beta_2 \bar{x_i} + \gamma z_i +  u_{0i}
\]</span></p>
<p>Now we can substitute into the previous multilevel equation and we
have our within-between model:</p>
<p><span class="math display">\[
y_{it} = \beta_{0} + \beta_1(x_{it} - \bar{x_i})  
+ \beta_2 \bar{x_i} + \gamma z_i +  u_{0i} + \epsilon_{it}
\]</span></p>
<p>The <span class="math inline">\(\beta_1\)</span> has the same
interpretation as in the fixed effects model, these are the effects of
within-entity deviations of <span class="math inline">\(x\)</span> on
within-entity deviations of <span class="math inline">\(y\)</span>. The
<span class="math inline">\(\beta_2\)</span> is basically predicting the
<span class="math inline">\(\bar{y_i}\)</span>, however, so these
coefficients are helpful for predicting differences in mean levels
across entities. The same is true for the <span class="math inline">\(z_i\)</span>.</p>
<p>A similar model that I call the “contextual” model because this is
how it is often interpreted (see, e.g., Raudenbush &amp; Bryk, 2002).
Here we do not demean the <span class="math inline">\(x_i\)</span>:</p>
<p><span class="math display">\[
y_{it} = \beta_{0} + \beta_1 x_{it}
+ \beta_2 \bar{x_i} + \gamma z_i +  u_{0i} + \epsilon_{it}
\]</span></p>
<p>Believe it or not, the <span class="math inline">\(\beta_1\)</span>
is unchanged in this model; it is the <span class="math inline">\(\beta_2\)</span> that changes. The interpretation
of <span class="math inline">\(\beta_2\)</span> becomes a the
<em>difference</em> between the within- and between-entities effects. A
significant coefficient for <span class="math inline">\(\beta_2\)</span>
means significant differences between the within- and between-entity
effects. For those who are familiar, this is like a variable-by-variable
Hausman test. Substantively, <span class="math inline">\(\beta_2\)</span> is often interpreted as a
<em>contextual</em> effect.</p>
<p>From this framework, we can do cross-level interactions, random
slopes, generalized linear models, and all kinds of interesting
stuff.</p>
<div class="section level4">
<h4 id="a-note-on-interactions">A note on interactions<a class="anchor" aria-label="anchor" href="#a-note-on-interactions"></a>
</h4>
<p>In the fixed effects framework, it is generally considered wrong to
operationalize an interaction between two time-varying variables (let’s
call them <span class="math inline">\(w\)</span> and <span class="math inline">\(x\)</span>) by taking the product of their
individual-demeaned forms. That is, you are <strong>not</strong>
supposed to generate the interaction term <span class="math inline">\(xw_{it}\)</span> by doing this:</p>
<p><span class="math display">\[
xw_{it} = (x_{it} - \bar{x_{i}}) \times (w_{it} - \bar{w_i})
\]</span></p>
<p>Instead, the conventional wisdom goes, you should first take the
product of the observed variables and subtract the individual-level mean
of that product, like so:</p>
<p><span class="math display">\[
xw_{it} = x_{it}w_{it} - \overline{xw}_i
\]</span></p>
<p>Where <span class="math inline">\(\overline{xw}_i\)</span> can also
be expressed as <span class="math inline">\(\frac{\sum_{t=1}^{T_i}{x_{it}w_{it}}}{T_i}\)</span>,
the sum of all products for each <span class="math inline">\(i\)</span>
divided by the number of time points for each <span class="math inline">\(i\)</span>, <span class="math inline">\(T_i\)</span>.</p>
<p><a href="https://doi.org/10.1177/0049124120914934" class="external-link">Giesselmann and
Schmidt-Catran (2020)</a> show that this conventional method for
generating <span class="math inline">\(xw_{it}\)</span> does not have
the unbiasedness that the individual terms do. I’ll leave it to them to
explain why exactly this is, but the solution is to start with the
first, wrong version of <span class="math inline">\(xw_{it}\)</span>,
which I’ll call <span class="math inline">\(xw_{it}^*\)</span>, and
subtract <em>its</em> mean too:</p>
<p><span class="math display">\[
xw_{it}^* = (x_{it} - \bar{x_{i}}) \times (w_{it} - \bar{w_i}) \\
xw_{it} = xw_{it}^* - \overline{xw_i^*}
\]</span></p>
<p>I call this the “double-demeaning” approach to interactions, in
contrast to the one-time demeaning in the conventional approach. By
default, <code><a href="../reference/wbm.html">wbm()</a></code> calculates interactions via the
double-demeaning method. You can change this via the
<code>interaction.style</code> argument if you need your results to
match other software.</p>
</div>
</div>
<div class="section level3">
<h3 id="fitting-within-between-models">Fitting within-between models<a class="anchor" aria-label="anchor" href="#fitting-within-between-models"></a>
</h3>
<p>The workhorse function for within-between models is
<code><a href="../reference/wbm.html">wbm()</a></code>, which is built on top of <code>lme4</code>’s
<code>lmerMod()</code> and <code>glmerMod()</code>. It is not so hard to
understand how to treat your data to estimate within-between models, but
the programming can be a challenge to those who aren’t skilled with R
(or whatever else they might use) and is error-prone in any case.</p>
<p>The main thing to know in order to use <code><a href="../reference/wbm.html">wbm()</a></code> is how the
model formula works, because it’s a little different from your typical
regression model. It is split into up to 3 parts, each for a different
kind of variable. Each part is separated by a <code>|</code>. The
pattern is like this:</p>
<pre><code><span><span class="va">dependent</span> <span class="op">~</span> <span class="va">time_varying</span> <span class="op">|</span> <span class="va">time_invariant</span> <span class="op">|</span> <span class="va">cross_lev_interactions</span> <span class="op">+</span> <span class="op">(</span><span class="va">random_slopes</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span></span></code></pre>
<p>So you start with your dependent variable on the left-hand side like
normal and then what comes next are variables that vary over time. You
will only get within-entity estimates for these variables. Next are
time-invariant variables; the between-entity terms for the time-varying
variables are added automatically so no need to try to include them
here. Finally, in the third part you can specify cross-level
interactions (i.e., within-entity by between-entity/time-invariant) as
well as additional random effects terms using the
<code>lme4</code>-style syntax. By default, <code>(1 | id)</code> (or
whatever the ID variable is) is added internally for a random intercept
so you do not need to include it yourself.</p>
<p>Let’s walk through an example with the <code>wages</code> data we
looked at briefly earlier. We’ll predict the logarithm of wages
(<code>lwage</code>) using weeks worked (<code>wks</code>), union
membership (<code>union</code>), marital status (<code>ms</code>), blue
(vs. white) collar job status (<code>occ</code>), black race
(<code>blk</code>), and female sex (<code>fem</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wbm.html">wbm</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">wks</span> <span class="op">+</span> <span class="va">union</span> <span class="op">+</span> <span class="va">ms</span> <span class="op">+</span> <span class="va">occ</span> <span class="op">|</span> <span class="va">blk</span> <span class="op">+</span> <span class="va">fem</span>, data <span class="op">=</span> <span class="va">wages</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">MODEL INFO:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span><span style="font-style: italic;">Entities: </span>595</span></span>
<span><span class="co">## <span style="font-style: italic;">Time periods: </span>1-7</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent variable: </span>lwage</span></span>
<span><span class="co">## <span style="font-style: italic;">Model type:</span> Linear mixed effects</span></span>
<span><span class="co">## <span style="font-style: italic;">Specification: </span>within-between</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">MODEL FIT:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">AIC = </span>2036.78, <span style="font-style: italic;">BIC = </span>2119.13</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (fixed effects) = </span>0.27</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (total) = </span>0.69</span></span>
<span><span class="co"><span style="font-style: italic;">## Entity ICC = </span>0.57</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">WITHIN EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>----------------------------------------------------</span></span>
<span><span class="co">##                Est.   S.E.   t val.      d.f.      p</span></span>
<span><span class="co">## ----------- ------- ------ -------- --------- ------</span></span>
<span><span class="co">## wks            0.00   0.00     1.06   3566.00   0.29</span></span>
<span><span class="co">## union          0.06   0.03     2.53   3566.00   0.01</span></span>
<span><span class="co">## ms            -0.08   0.03    -2.57   3566.00   0.01</span></span>
<span><span class="co">## occ           -0.08   0.02    -3.32   3566.00   0.00</span></span>
<span><span class="co">## ----------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">BETWEEN EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>----------------------------------------------------------</span></span>
<span><span class="co">##                       Est.   S.E.   t val.     d.f.      p</span></span>
<span><span class="co">## ------------------ ------- ------ -------- -------- ------</span></span>
<span><span class="co">## (Intercept)           6.30   0.20    30.85   588.00   0.00</span></span>
<span><span class="co">## imean(wks)            0.01   0.00     2.25   588.00   0.02</span></span>
<span><span class="co">## imean(union)          0.15   0.03     4.67   588.00   0.00</span></span>
<span><span class="co">## imean(ms)             0.17   0.05     3.07   588.00   0.00</span></span>
<span><span class="co">## imean(occ)           -0.41   0.03   -13.31   588.00   0.00</span></span>
<span><span class="co">## blk                  -0.15   0.05    -2.81   588.00   0.01</span></span>
<span><span class="co">## fem                  -0.32   0.06    -4.96   588.00   0.00</span></span>
<span><span class="co">## ----------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-style: italic;">p values calculated using Satterthwaite d.f.</span></span></span>
<span><span class="co"><span style="font-style: italic;">## </span> </span></span>
<span><span class="co">## <span style="font-weight: bold;">RANDOM EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>------------------------------------</span></span>
<span><span class="co">##   Group      Parameter    Std. Dev. </span></span>
<span><span class="co">## ---------- ------------- -----------</span></span>
<span><span class="co">##     id      (Intercept)    0.2992   </span></span>
<span><span class="co">##  Residual                  0.2589   </span></span>
<span><span class="co">## ------------------------------------</span></span></code></pre>
<p>As you can see, the output distinguishes within- and between-entity
effects. When you see <code>imean()</code> around a variable, that is
the between-entity effect represented as the individual mean.</p>
<p>Here, we see there seems to be a wage penalty for switching from
white collar to blue collar work (<code>occ</code>) and although married
people earn more (<code>imean(ms)</code>), just becoming married
(<code>ms</code>) coincides with a drop in earnings. We also see a boost
in earnings from joining a union (<code>union</code>).</p>
<p>Maybe we think the timing of the marriage effect is off and the true
effect occurs the time period after a person becomes married. We can ask
for the lagged effect using <code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wbm.html">wbm</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">wks</span> <span class="op">+</span> <span class="va">union</span> <span class="op">+</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">ms</span><span class="op">)</span> <span class="op">+</span> <span class="va">occ</span> <span class="op">|</span> <span class="va">blk</span> <span class="op">+</span> <span class="va">fem</span>, data <span class="op">=</span> <span class="va">wages</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">MODEL INFO:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span><span style="font-style: italic;">Entities: </span>595</span></span>
<span><span class="co">## <span style="font-style: italic;">Time periods: </span>2-7</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent variable: </span>lwage</span></span>
<span><span class="co">## <span style="font-style: italic;">Model type:</span> Linear mixed effects</span></span>
<span><span class="co">## <span style="font-style: italic;">Specification: </span>within-between</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">MODEL FIT:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">AIC = </span>1247.06, <span style="font-style: italic;">BIC = </span>1327.41</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (fixed effects) = </span>0.28</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (total) = </span>0.74</span></span>
<span><span class="co"><span style="font-style: italic;">## Entity ICC = </span>0.64</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">WITHIN EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>------------------------------------------------------</span></span>
<span><span class="co">##                  Est.   S.E.   t val.      d.f.      p</span></span>
<span><span class="co">## ------------- ------- ------ -------- --------- ------</span></span>
<span><span class="co">## wks             -0.00   0.00    -1.43   2999.92   0.15</span></span>
<span><span class="co">## union            0.05   0.03     1.82   2991.78   0.07</span></span>
<span><span class="co">## lag(ms)         -0.04   0.03    -1.19   2971.04   0.23</span></span>
<span><span class="co">## occ             -0.06   0.02    -2.56   2992.05   0.01</span></span>
<span><span class="co">## ------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">BETWEEN EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>------------------------------------------------------------</span></span>
<span><span class="co">##                         Est.   S.E.   t val.     d.f.      p</span></span>
<span><span class="co">## -------------------- ------- ------ -------- -------- ------</span></span>
<span><span class="co">## (Intercept)             6.36   0.21    30.51   588.00   0.00</span></span>
<span><span class="co">## imean(wks)              0.01   0.00     2.25   588.00   0.02</span></span>
<span><span class="co">## imean(union)            0.15   0.03     4.48   588.00   0.00</span></span>
<span><span class="co">## imean(lag(ms))          0.15   0.06     2.80   588.01   0.01</span></span>
<span><span class="co">## imean(occ)             -0.41   0.03   -13.16   588.02   0.00</span></span>
<span><span class="co">## blk                    -0.15   0.05    -2.92   587.99   0.00</span></span>
<span><span class="co">## fem                    -0.33   0.06    -5.17   588.01   0.00</span></span>
<span><span class="co">## ------------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-style: italic;">p values calculated using Satterthwaite d.f.</span></span></span>
<span><span class="co"><span style="font-style: italic;">## </span> </span></span>
<span><span class="co">## <span style="font-weight: bold;">RANDOM EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>------------------------------------</span></span>
<span><span class="co">##   Group      Parameter    Std. Dev. </span></span>
<span><span class="co">## ---------- ------------- -----------</span></span>
<span><span class="co">##     id      (Intercept)    0.3068   </span></span>
<span><span class="co">##  Residual                  0.2325   </span></span>
<span><span class="co">## ------------------------------------</span></span></code></pre>
<p>Well that doesn’t change the direction of the estimate, but it also
moved it sufficiently close to 0 that we can’t say much about it one way
or another.</p>
<p>Keep in mind that you do not have to stick to linear models. Using
the <code>family</code> argument (just like <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>), you can
estimate logit (<code>family = binomial</code>), probit
(<code>family = binomal(link = "probit")</code>), poisson
(<code>family = poisson</code>), or other model families and links as
needed.</p>
<div class="section level4">
<h4 id="growth-curves">Growth curves<a class="anchor" aria-label="anchor" href="#growth-curves"></a>
</h4>
<p>Now maybe we want to include an effect of time since wages tend to go
up for everyone, on average, over time. We can just include the time
variable in the formula or set <code>use.wave</code> to
<code>TRUE</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wbm.html">wbm</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">wks</span> <span class="op">+</span> <span class="va">union</span> <span class="op">+</span> <span class="va">ms</span> <span class="op">+</span> <span class="va">occ</span> <span class="op">|</span> <span class="va">blk</span> <span class="op">+</span> <span class="va">fem</span>, data <span class="op">=</span> <span class="va">wages</span>, use.wave <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">MODEL INFO:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span><span style="font-style: italic;">Entities: </span>595</span></span>
<span><span class="co">## <span style="font-style: italic;">Time periods: </span>1-7</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent variable: </span>lwage</span></span>
<span><span class="co">## <span style="font-style: italic;">Model type:</span> Linear mixed effects</span></span>
<span><span class="co">## <span style="font-style: italic;">Specification: </span>within-between</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">MODEL FIT:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">AIC = </span>-1688.87, <span style="font-style: italic;">BIC = </span>-1600.19</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (fixed effects) = </span>0.44</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (total) = </span>0.89</span></span>
<span><span class="co"><span style="font-style: italic;">## Entity ICC = </span>0.8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">WITHIN EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>----------------------------------------------------</span></span>
<span><span class="co">##                Est.   S.E.   t val.      d.f.      p</span></span>
<span><span class="co">## ----------- ------- ------ -------- --------- ------</span></span>
<span><span class="co">## wks            0.00   0.00     1.91   3565.00   0.06</span></span>
<span><span class="co">## union          0.03   0.02     2.29   3565.00   0.02</span></span>
<span><span class="co">## ms            -0.03   0.02    -1.71   3565.00   0.09</span></span>
<span><span class="co">## occ           -0.03   0.01    -1.81   3565.00   0.07</span></span>
<span><span class="co">## ----------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">BETWEEN EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>-----------------------------------------------------------</span></span>
<span><span class="co">##                       Est.   S.E.   t val.      d.f.      p</span></span>
<span><span class="co">## ------------------ ------- ------ -------- --------- ------</span></span>
<span><span class="co">## (Intercept)           5.91   0.20    28.95    588.63   0.00</span></span>
<span><span class="co">## imean(wks)            0.01   0.00     2.25    587.99   0.02</span></span>
<span><span class="co">## imean(union)          0.15   0.03     4.67    588.00   0.00</span></span>
<span><span class="co">## imean(ms)             0.17   0.05     3.07    588.00   0.00</span></span>
<span><span class="co">## imean(occ)           -0.41   0.03   -13.31    588.00   0.00</span></span>
<span><span class="co">## blk                  -0.15   0.05    -2.81    588.00   0.01</span></span>
<span><span class="co">## fem                  -0.32   0.06    -4.96    588.00   0.00</span></span>
<span><span class="co">## t                     0.10   0.00    81.29   3565.00   0.00</span></span>
<span><span class="co">## -----------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-style: italic;">p values calculated using Satterthwaite d.f.</span></span></span>
<span><span class="co"><span style="font-style: italic;">## </span> </span></span>
<span><span class="co">## <span style="font-weight: bold;">RANDOM EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>------------------------------------</span></span>
<span><span class="co">##   Group      Parameter    Std. Dev. </span></span>
<span><span class="co">## ---------- ------------- -----------</span></span>
<span><span class="co">##     id      (Intercept)    0.3094   </span></span>
<span><span class="co">##  Residual                  0.1533   </span></span>
<span><span class="co">## ------------------------------------</span></span></code></pre>
<p>Including <code>t</code> wipes out some of those previously observed
effects. Believe it or not, we just fit a growth curve model!</p>
<p>Now, we might think people have different trajectories. We can
include that as a random slope, which will go in the third part of the
formula.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wbm.html">wbm</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">wks</span> <span class="op">+</span> <span class="va">union</span> <span class="op">+</span> <span class="va">ms</span> <span class="op">+</span> <span class="va">occ</span> <span class="op">|</span> <span class="va">blk</span> <span class="op">+</span> <span class="va">fem</span> <span class="op">|</span> <span class="op">(</span><span class="va">t</span> <span class="op">|</span> <span class="va">id</span><span class="op">)</span>, use.wave <span class="op">=</span> <span class="cn">TRUE</span>, data <span class="op">=</span> <span class="va">wages</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">MODEL INFO:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span><span style="font-style: italic;">Entities: </span>595</span></span>
<span><span class="co">## <span style="font-style: italic;">Time periods: </span>1-7</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent variable: </span>lwage</span></span>
<span><span class="co">## <span style="font-style: italic;">Model type:</span> Linear mixed effects</span></span>
<span><span class="co">## <span style="font-style: italic;">Specification: </span>within-between</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">MODEL FIT:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">AIC = </span>-2064.42, <span style="font-style: italic;">BIC = </span>-1963.07</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (fixed effects) = </span>0.43</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (total) = </span>0.92</span></span>
<span><span class="co"><span style="font-style: italic;">## Entity ICC = </span>0.84</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">WITHIN EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>----------------------------------------------------</span></span>
<span><span class="co">##                Est.   S.E.   t val.      d.f.      p</span></span>
<span><span class="co">## ----------- ------- ------ -------- --------- ------</span></span>
<span><span class="co">## wks            0.00   0.00     1.47   3498.40   0.14</span></span>
<span><span class="co">## union          0.02   0.01     1.61   3561.26   0.11</span></span>
<span><span class="co">## ms            -0.04   0.02    -1.97   3416.40   0.05</span></span>
<span><span class="co">## occ           -0.02   0.01    -1.42   3563.73   0.16</span></span>
<span><span class="co">## ----------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">BETWEEN EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>----------------------------------------------------------</span></span>
<span><span class="co">##                       Est.   S.E.   t val.     d.f.      p</span></span>
<span><span class="co">## ------------------ ------- ------ -------- -------- ------</span></span>
<span><span class="co">## (Intercept)           5.93   0.20    29.69   588.53   0.00</span></span>
<span><span class="co">## imean(wks)            0.01   0.00     2.12   587.98   0.03</span></span>
<span><span class="co">## imean(union)          0.16   0.03     4.90   587.97   0.00</span></span>
<span><span class="co">## imean(ms)             0.17   0.05     3.25   588.06   0.00</span></span>
<span><span class="co">## imean(occ)           -0.39   0.03   -13.16   588.01   0.00</span></span>
<span><span class="co">## blk                  -0.13   0.05    -2.49   588.00   0.01</span></span>
<span><span class="co">## fem                  -0.31   0.06    -4.90   588.07   0.00</span></span>
<span><span class="co">## t                     0.10   0.00    54.67   594.66   0.00</span></span>
<span><span class="co">## ----------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-style: italic;">p values calculated using Satterthwaite d.f.</span></span></span>
<span><span class="co"><span style="font-style: italic;">## </span> </span></span>
<span><span class="co">## <span style="font-weight: bold;">RANDOM EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>------------------------------------</span></span>
<span><span class="co">##   Group      Parameter    Std. Dev. </span></span>
<span><span class="co">## ---------- ------------- -----------</span></span>
<span><span class="co">##     id      (Intercept)    0.3057   </span></span>
<span><span class="co">##     id           t         0.03499  </span></span>
<span><span class="co">##  Residual                  0.1334   </span></span>
<span><span class="co">## ------------------------------------</span></span></code></pre>
<p>And now we have a latent growth curve model. The general effect on
the other coefficients is more uncertainty and attenuated estimates.
It’s worth keeping in mind that it is sometimes wrong to use a growth
curve model like this if you think the variables in your model
<em>cause</em> the time trend; if you think wages are going up because
more people are moving into white collar work, then including the growth
curve will make it harder for you to see the true effect of
<code>occ</code>.</p>
</div>
<div class="section level4">
<h4 id="contextual-within-and-random-effects-specifications">Contextual, within, and random effects specifications<a class="anchor" aria-label="anchor" href="#contextual-within-and-random-effects-specifications"></a>
</h4>
<p>By default, <code><a href="../reference/wbm.html">wbm()</a></code> does as the name suggests. But if
you’d rather have the contextual model described earlier, in which the
means are not subtracted from the time varying variables, that’s an
option too.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wbm.html">wbm</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">wks</span> <span class="op">+</span> <span class="va">union</span> <span class="op">+</span> <span class="va">ms</span> <span class="op">+</span> <span class="va">occ</span> <span class="op">|</span> <span class="va">blk</span> <span class="op">+</span> <span class="va">fem</span>, data <span class="op">=</span> <span class="va">wages</span>, model <span class="op">=</span> <span class="st">"contextual"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">MODEL INFO:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span><span style="font-style: italic;">Entities: </span>595</span></span>
<span><span class="co">## <span style="font-style: italic;">Time periods: </span>1-7</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent variable: </span>lwage</span></span>
<span><span class="co">## <span style="font-style: italic;">Model type:</span> Linear mixed effects</span></span>
<span><span class="co">## <span style="font-style: italic;">Specification: </span>contextual</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">MODEL FIT:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">AIC = </span>2036.78, <span style="font-style: italic;">BIC = </span>2119.13</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (fixed effects) = </span>0.27</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (total) = </span>0.69</span></span>
<span><span class="co"><span style="font-style: italic;">## Entity ICC = </span>0.57</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">WITHIN EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>----------------------------------------------------</span></span>
<span><span class="co">##                Est.   S.E.   t val.      d.f.      p</span></span>
<span><span class="co">## ----------- ------- ------ -------- --------- ------</span></span>
<span><span class="co">## wks            0.00   0.00     1.06   3566.00   0.29</span></span>
<span><span class="co">## union          0.06   0.03     2.53   3566.00   0.01</span></span>
<span><span class="co">## ms            -0.08   0.03    -2.57   3566.00   0.01</span></span>
<span><span class="co">## occ           -0.08   0.02    -3.32   3566.00   0.00</span></span>
<span><span class="co">## ----------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">CONTEXTUAL EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>-----------------------------------------------------------</span></span>
<span><span class="co">##                       Est.   S.E.   t val.      d.f.      p</span></span>
<span><span class="co">## ------------------ ------- ------ -------- --------- ------</span></span>
<span><span class="co">## (Intercept)           6.30   0.20    30.85    588.00   0.00</span></span>
<span><span class="co">## imean(wks)            0.01   0.00     1.93    660.18   0.05</span></span>
<span><span class="co">## imean(union)          0.09   0.04     2.15   1411.72   0.03</span></span>
<span><span class="co">## imean(ms)             0.25   0.06     3.95   1047.31   0.00</span></span>
<span><span class="co">## imean(occ)           -0.33   0.04    -8.55   1401.80   0.00</span></span>
<span><span class="co">## blk                  -0.15   0.05    -2.81    588.00   0.01</span></span>
<span><span class="co">## fem                  -0.32   0.06    -4.96    588.00   0.00</span></span>
<span><span class="co">## -----------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-style: italic;">p values calculated using Satterthwaite d.f.</span></span></span>
<span><span class="co"><span style="font-style: italic;">## </span> </span></span>
<span><span class="co">## <span style="font-weight: bold;">RANDOM EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>------------------------------------</span></span>
<span><span class="co">##   Group      Parameter    Std. Dev. </span></span>
<span><span class="co">## ---------- ------------- -----------</span></span>
<span><span class="co">##     id      (Intercept)    0.2992   </span></span>
<span><span class="co">##  Residual                  0.2589   </span></span>
<span><span class="co">## ------------------------------------</span></span></code></pre>
<p>Now the individual means have a new interpretation as the difference
in effect compared to the within-entity estimates.</p>
<p>If you don’t want to use any of the time-invariant variables, you can
also just ask for the “within” estimator:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wbm.html">wbm</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">wks</span> <span class="op">+</span> <span class="va">union</span> <span class="op">+</span> <span class="va">ms</span> <span class="op">+</span> <span class="va">occ</span>, data <span class="op">=</span> <span class="va">wages</span>, model <span class="op">=</span> <span class="st">"within"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">MODEL INFO:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span><span style="font-style: italic;">Entities: </span>595</span></span>
<span><span class="co">## <span style="font-style: italic;">Time periods: </span>1-7</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent variable: </span>lwage</span></span>
<span><span class="co">## <span style="font-style: italic;">Model type:</span> Linear mixed effects</span></span>
<span><span class="co">## <span style="font-style: italic;">Specification: </span>within</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">MODEL FIT:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">AIC = </span>2266.01, <span style="font-style: italic;">BIC = </span>2310.35</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (fixed effects) = </span>0</span></span>
<span><span class="co">## <span style="font-style: italic;">Pseudo-R² (total) = </span>0.69</span></span>
<span><span class="co"><span style="font-style: italic;">## Entity ICC = </span>0.69</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ----------------------------------------------------------</span></span>
<span><span class="co">##                      Est.   S.E.   t val.      d.f.      p</span></span>
<span><span class="co">## ----------------- ------- ------ -------- --------- ------</span></span>
<span><span class="co">## (Intercept)          6.68   0.02   413.08    594.00   0.00</span></span>
<span><span class="co">## wks                  0.00   0.00     1.06   3566.00   0.29</span></span>
<span><span class="co">## union                0.06   0.03     2.53   3566.00   0.01</span></span>
<span><span class="co">## ms                  -0.08   0.03    -2.57   3566.00   0.01</span></span>
<span><span class="co">## occ                 -0.08   0.02    -3.32   3566.00   0.00</span></span>
<span><span class="co">## ----------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-style: italic;">p values calculated using Satterthwaite d.f.</span></span></span>
<span><span class="co"><span style="font-style: italic;">## </span> </span></span>
<span><span class="co">## <span style="font-weight: bold;">RANDOM EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>------------------------------------</span></span>
<span><span class="co">##   Group      Parameter    Std. Dev. </span></span>
<span><span class="co">## ---------- ------------- -----------</span></span>
<span><span class="co">##     id      (Intercept)    0.3819   </span></span>
<span><span class="co">##  Residual                  0.2589   </span></span>
<span><span class="co">## ------------------------------------</span></span></code></pre>
<p>This can help declutter your output when you really just don’t care
about the between-subjects effects.</p>
</div>
</div>
<div class="section level3">
<h3 id="using-gee-to-fit-within-between-models">Using GEE to fit within-between models<a class="anchor" aria-label="anchor" href="#using-gee-to-fit-within-between-models"></a>
</h3>
<p>You don’t have to estimate these models using multilevel models and
in fact you may get better inferences by avoiding some of the
assumptions inherent to multilevel modeling (see McNeish, 2019). You can
use the semiparametric generalized estimating equations (GEE) approach
to estimation, with the main tradeoff being that you can no longer use
random slopes or anything like that. But if you only care about the
average effects across all entities, GEE can be a better approach that
doesn’t require you to be right about the distribution of effects and
several other assumptions.</p>
<p><code><a href="../reference/wbgee.html">wbgee()</a></code> builds on <code>geeglm()</code> from the
<code>geepack</code> package and works just like <code><a href="../reference/wbm.html">wbm()</a></code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wbgee.html">wbgee</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">wks</span> <span class="op">+</span> <span class="va">union</span> <span class="op">+</span> <span class="va">ms</span> <span class="op">+</span> <span class="va">occ</span> <span class="op">|</span> <span class="va">blk</span> <span class="op">+</span> <span class="va">fem</span>, data <span class="op">=</span> <span class="va">wages</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required namespace: geepack</span></span></code></pre>
<pre><code><span><span class="co">## Registered S3 methods overwritten by 'broom':</span></span>
<span><span class="co">##   method            from  </span></span>
<span><span class="co">##   tidy.glht         jtools</span></span>
<span><span class="co">##   tidy.summary.glht jtools</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">MODEL INFO:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span><span style="font-style: italic;">Entities: </span>595</span></span>
<span><span class="co">## <span style="font-style: italic;">Time periods: </span>1-7</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent variable: </span>lwage</span></span>
<span><span class="co">## <span style="font-style: italic;">Model type:</span> Linear GEE</span></span>
<span><span class="co">## <span style="font-style: italic;">Variance: </span>ar1 (alpha = 0.79)</span></span>
<span><span class="co">## <span style="font-style: italic;">Specification: </span>within-between</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">MODEL FIT:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">QIC = </span>672.19, <span style="font-style: italic;">QICu = </span>669.6, <span style="font-style: italic;">CIC = </span>12.29</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">WITHIN EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>------------------------------------------</span></span>
<span><span class="co">##                Est.   S.E.   z val.      p</span></span>
<span><span class="co">## ----------- ------- ------ -------- ------</span></span>
<span><span class="co">## wks            0.00   0.00     0.07   0.94</span></span>
<span><span class="co">## union          0.03   0.02     1.32   0.19</span></span>
<span><span class="co">## ms            -0.08   0.03    -2.78   0.01</span></span>
<span><span class="co">## occ           -0.03   0.02    -1.64   0.10</span></span>
<span><span class="co">## ------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">BETWEEN EFFECTS:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>-------------------------------------------------</span></span>
<span><span class="co">##                       Est.   S.E.   z val.      p</span></span>
<span><span class="co">## ------------------ ------- ------ -------- ------</span></span>
<span><span class="co">## (Intercept)           6.29   0.22    28.48   0.00</span></span>
<span><span class="co">## imean(wks)            0.01   0.00     2.09   0.04</span></span>
<span><span class="co">## imean(union)          0.16   0.03     4.74   0.00</span></span>
<span><span class="co">## imean(ms)             0.17   0.06     3.01   0.00</span></span>
<span><span class="co">## imean(occ)           -0.41   0.03   -12.95   0.00</span></span>
<span><span class="co">## blk                  -0.14   0.05    -2.90   0.00</span></span>
<span><span class="co">## fem                  -0.30   0.06    -4.89   0.00</span></span>
<span><span class="co">## -------------------------------------------------</span></span></code></pre>
<p>This gives us more conservative estimates, in general. Note that by
default, <code><a href="../reference/wbgee.html">wbgee()</a></code> uses an AR-1 working error correlation
structure in estimation. This makes sense in general but at times it may
make sense to use “exchangeable” as the argument to <code>cor.str</code>
which assumes all within-entity correlations are equal regardless of
time lag. Other options include “unstructured”, which can be very
computationally intensive, and “independence,” assuming no correlation
within entities.</p>
<p>Like <code><a href="../reference/wbm.html">wbm()</a></code>, you can do generalized linear models via the
<code>family</code> argument. It is for these generalized linear models
that GEEs are likely to stand out the most in terms of added benefit
above and beyond the multilevel models, although this is not a
well-tested question to my knowledge.</p>
</div>
<div class="section level3">
<h3 id="asymmetric-effects">Asymmetric effects<a class="anchor" aria-label="anchor" href="#asymmetric-effects"></a>
</h3>
<p>Sometimes, theory may suggest that increases in a variable have a
different effect than decreases in a variable. For instance, getting
married and getting divorced are probably not equivalent (in the sense
that one is the exact opposite of the other) in their effects on other
outcomes. Allison (2019) described a method for estimating models with
asymmetric effects based on first differences.</p>
<p>First, you take first differences:</p>
<p><span class="math display">\[
y_{it} - y_{it-1} = (\mu_t - \mu_{t-1}) + \beta(x_{it} - x_{it -1}) +
(\epsilon_{it} - \epsilon_{it-1})
\]</span></p>
<p>We need a slightly different model for asymmetric effects in which we
decompose the differences into positive and negative variables.</p>
<p>Our asymmetric effects model will be:</p>
<p><span class="math display">\[
y_{it} - y_{it-1} = (\mu_t - \mu_{t-1}) + \beta^+x_{it}^+ +
\beta^-x_{it}^- +
(\epsilon_{it} - \epsilon_{it-1})
\]</span></p>
<p>Where</p>
<p><span class="math display">\[
x_{it}^+ = x_{it} - x_{it -1} \text{ if } (x_{it} - x_{it -1}) &gt; 0,
\text{otherwise } 0 \\
x_{it}^- = -(x_{it} - x_{it -1}) \text{ if } (x_{it} - x_{it -1}) &lt;
0,
\text{otherwise } 0
\]</span></p>
<p>In other words, if the difference is positive, it becomes part of the
<span class="math inline">\(x_{it}^+\)</span> and if it is negative, it
is multiplied by -1 to be made positive and is made part of the <span class="math inline">\(x_{it}^-\)</span> variable. If the effects are
symmetric, <span class="math inline">\(\beta^+ = -\beta^-\)</span>.</p>
<p>After fitting the model via GLS, we can then do a test of the
contrasts of the <span class="math inline">\(\beta^+\)</span> and <span class="math inline">\(\beta^-\)</span> coefficients as a formal way to
assess the presence of asymmetric effects.</p>
<p>Here’s how it works with the <code>panelr</code> function,
<code><a href="../reference/asym.html">asym()</a></code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/asym.html">asym</a></span><span class="op">(</span><span class="va">lwage</span> <span class="op">~</span> <span class="va">ms</span> <span class="op">+</span> <span class="va">occ</span> <span class="op">+</span> <span class="va">union</span> <span class="op">+</span> <span class="va">wks</span>, data <span class="op">=</span> <span class="va">wages</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required namespace: car</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">MODEL INFO:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span><span style="font-style: italic;">Entities: </span>595</span></span>
<span><span class="co">## <span style="font-style: italic;">Time periods: </span>2-7</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent variable: </span>lwage</span></span>
<span><span class="co">## <span style="font-style: italic;">Model type: </span>Linear asymmetric effects (first differences)</span></span>
<span><span class="co">## <span style="font-style: italic;">Variance structure: </span>toeplitz-1 (theta = -0.44) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-style: italic;">Standard errors:</span> Cluster-robust (CR2) </span></span>
<span><span class="co">## ------------------------------------------------</span></span>
<span><span class="co">##                      Est.   S.E.   t val.      p</span></span>
<span><span class="co">## ----------------- ------- ------ -------- ------</span></span>
<span><span class="co">## (Intercept)          0.10   0.00    41.12   0.00</span></span>
<span><span class="co">## +ms                 -0.04   0.02    -1.95   0.05</span></span>
<span><span class="co">## -ms                  0.04   0.04     1.23   0.22</span></span>
<span><span class="co">## +occ                -0.02   0.02    -0.97   0.33</span></span>
<span><span class="co">## -occ                 0.03   0.02     1.17   0.24</span></span>
<span><span class="co">## +union               0.01   0.02     0.64   0.52</span></span>
<span><span class="co">## -union              -0.03   0.03    -1.11   0.27</span></span>
<span><span class="co">## +wks                 0.00   0.00     0.48   0.63</span></span>
<span><span class="co">## -wks                -0.00   0.00    -0.35   0.72</span></span>
<span><span class="co">## ------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">Tests of asymmetric effects:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>--------------------------</span></span>
<span><span class="co">##               chi^2      p</span></span>
<span><span class="co">## ----------- ------- ------</span></span>
<span><span class="co">## ms             0.01   0.92</span></span>
<span><span class="co">## occ            0.19   0.66</span></span>
<span><span class="co">## union          0.44   0.51</span></span>
<span><span class="co">## wks            0.00   1.00</span></span>
<span><span class="co">## --------------------------</span></span></code></pre>
<p>As you can see, in a model comparable to our within-between model
from earlier, the effects seem quite symmetric.</p>
<p>Let’s look at the <code>teen</code> data from earlier, where
<code>spouse</code> indicates whether the respondent is living with a
spouse, <code>inschool</code> indicates whether the respondent is
enrolled in school, and <code>hours</code> is the hours worked in the
week of the survey.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/asym.html">asym</a></span><span class="op">(</span><span class="va">hours</span> <span class="op">~</span> <span class="va">spouse</span> <span class="op">+</span> <span class="va">inschool</span>, data <span class="op">=</span> <span class="va">teen</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">MODEL INFO:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span><span style="font-style: italic;">Entities: </span>1151</span></span>
<span><span class="co">## <span style="font-style: italic;">Time periods: </span>2-5</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent variable: </span>hours</span></span>
<span><span class="co">## <span style="font-style: italic;">Model type: </span>Linear asymmetric effects (first differences)</span></span>
<span><span class="co">## <span style="font-style: italic;">Variance structure: </span>toeplitz-1 (theta = -0.54) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-style: italic;">Standard errors:</span> Cluster-robust (CR2) </span></span>
<span><span class="co">## ------------------------------------------------</span></span>
<span><span class="co">##                      Est.   S.E.   t val.      p</span></span>
<span><span class="co">## ----------------- ------- ------ -------- ------</span></span>
<span><span class="co">## (Intercept)          1.16   0.15     7.74   0.00</span></span>
<span><span class="co">## +spouse             -4.71   1.15    -4.09   0.00</span></span>
<span><span class="co">## -spouse             -0.61   2.20    -0.28   0.78</span></span>
<span><span class="co">## +inschool           -5.65   1.29    -4.38   0.00</span></span>
<span><span class="co">## -inschool            7.66   0.69    11.09   0.00</span></span>
<span><span class="co">## ------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">Tests of asymmetric effects:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>-----------------------------</span></span>
<span><span class="co">##                  chi^2      p</span></span>
<span><span class="co">## -------------- ------- ------</span></span>
<span><span class="co">## spouse            6.21   0.01</span></span>
<span><span class="co">## inschool          2.14   0.14</span></span>
<span><span class="co">## -----------------------------</span></span></code></pre>
<p>Here we see an asymmetric effect of marriage: gaining a spouse
corresponds with fewer hours worked, but there’s no effect on work hours
when a spouse is lost. You can see in the lower table that this
difference in coefficients is associated with a fairly low <em>p</em>
value. There is only weak evidence of an asymmetric effect for
entering/leaving school.</p>
<div class="section level4">
<h4 id="asymmetric-effects-for-generalized-linear-models">Asymmetric effects for generalized linear models<a class="anchor" aria-label="anchor" href="#asymmetric-effects-for-generalized-linear-models"></a>
</h4>
<p>The downside to the first differences method is that it does not
generalize to non-continuous dependent variables — you can’t run a logit
model with a differenced binary outcome. Allison (2019) showed that you
can do a modified form for such situations.</p>
<p>Instead of including the <span class="math inline">\(x_{it}^+\)</span> and <span class="math inline">\(x_{it}^-\)</span> as predictors, you instead
create new variables <span class="math inline">\(z_{it}^+\)</span> and
<span class="math inline">\(z_{it}^-\)</span> that are the cumulative
sum of all differences prior to time <span class="math inline">\(t\)</span>.</p>
<p><span class="math display">\[
z_{it}^+ = \sum_{s = 1}^{t}{x_{is}^+} \\
z_{it}^- = \sum_{s = 1}^{t}{x_{is}^-} \\
\]</span></p>
<p>Note that at <span class="math inline">\(t = 1\)</span>, both are set
to 0. I’ll leave the details as to <em>why</em> this works to the
manuscript, but he shows that we’re left with the following
equation:</p>
<p><span class="math display">\[
y_{it} = \mu_t + \beta^+ z_{it}^+ + \beta^-z_{it}^- + \alpha_i +
\epsilon_{it}
\]</span></p>
<p>So we can treat this like a fixed effects model in which we just need
to address the <span class="math inline">\(\alpha_i\)</span>. For
situations like this that call for a conditional logit, as Allison used
in his paper, another option is the GEE with logit link.</p>
<p>Let’s try with the <code>teen</code> data, which also appears in
Allison (2019). Here our outcome variable is <code>pov</code>, poverty,
and there’s a new predictor, <code>mother</code>, an indicator for
whether the respondent has ever had any children.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/asym_gee.html">asym_gee</a></span><span class="op">(</span><span class="va">pov</span> <span class="op">~</span> <span class="va">mother</span> <span class="op">+</span> <span class="va">spouse</span> <span class="op">+</span> <span class="va">inschool</span> <span class="op">+</span> <span class="va">hours</span>, data <span class="op">=</span> <span class="va">teen</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>, </span>
<span>                  use.wave <span class="op">=</span> <span class="cn">TRUE</span>, wave.factor <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">mother does not decrease over time so -mother is not included in the model.</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">Unordered factor wave variable was converted to ordered. You should check</span></span></span>
<span><span class="co"><span style="color: #00BBBB;">## that the order is correct.</span></span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">MODEL INFO:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span><span style="font-style: italic;">Entities: </span>1151</span></span>
<span><span class="co">## <span style="font-style: italic;">Time periods: </span>2-5</span></span>
<span><span class="co">## <span style="font-style: italic;">Dependent variable: </span>pov</span></span>
<span><span class="co">## <span style="font-style: italic;">Model family: </span>binomial, <span style="font-style: italic;">Link: </span>logit</span></span>
<span><span class="co">## <span style="font-style: italic;">Variance: </span>ar1 (alpha = 0.33)</span></span>
<span><span class="co">## <span style="font-style: italic;">Specification: </span>Asymmetric effects (via GEE)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">MODEL FIT:</span></span></span>
<span><span class="co">## <span style="font-style: italic;">QIC = </span>5898.64, <span style="font-style: italic;">QICu = </span>5897.59, <span style="font-style: italic;">CIC = </span>11.52</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ------------------------------------------------</span></span>
<span><span class="co">##                      Est.   S.E.   z val.      p</span></span>
<span><span class="co">## ----------------- ------- ------ -------- ------</span></span>
<span><span class="co">## (Intercept)         -0.30   0.06    -5.19   0.00</span></span>
<span><span class="co">## +mother              0.72   0.11     6.63   0.00</span></span>
<span><span class="co">## +spouse             -0.70   0.14    -5.14   0.00</span></span>
<span><span class="co">## -spouse              0.43   0.25     1.71   0.09</span></span>
<span><span class="co">## +inschool           -0.02   0.16    -0.15   0.88</span></span>
<span><span class="co">## -inschool           -0.01   0.09    -0.09   0.93</span></span>
<span><span class="co">## +hours              -0.02   0.00    -8.17   0.00</span></span>
<span><span class="co">## -hours               0.01   0.00     1.61   0.11</span></span>
<span><span class="co">## wave.L               0.11   0.07     1.65   0.10</span></span>
<span><span class="co">## wave.Q              -0.00   0.05    -0.02   0.98</span></span>
<span><span class="co">## wave.C              -0.05   0.05    -0.97   0.33</span></span>
<span><span class="co">## ------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="font-weight: bold;">Tests of asymmetric effects:</span></span></span>
<span><span class="co"><span style="font-weight: bold;">## </span>-----------------------------</span></span>
<span><span class="co">##                  chi^2      p</span></span>
<span><span class="co">## -------------- ------- ------</span></span>
<span><span class="co">## spouse            1.10   0.29</span></span>
<span><span class="co">## inschool          0.04   0.85</span></span>
<span><span class="co">## hours            25.57   0.00</span></span>
<span><span class="co">## -----------------------------</span></span></code></pre>
<p>The results are broadly similar in terms of coefficient estimates to
those obtained by Allison. Unlike Allison, we do not have good evidence
of an asymmetric effect in the case of <code>spouse</code> but we do
have one in the case of <code>hours</code>. Note that
<code>mother</code> never goes down so the negative version of this
variable is dropped from the model with a message. To match Allison, I
also used <code>use.wave</code> to include the wave variable and
<code>wave.factor</code> to make it a factor variable.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Allison, P. D. (2009). Fixed effects regression models. Thousand
Oaks, CA: SAGE Publications. <a href="https://doi.org/10.4135/9781412993869.d33" class="external-link uri">https://doi.org/10.4135/9781412993869.d33</a></p>
<p>Allison, P. D. (2019). Asymmetric fixed-effects models for panel
data. <em>Socius</em>, <em>5</em>, 1–12. <a href="https://doi.org/10.1177/2378023119826441" class="external-link uri">https://doi.org/10.1177/2378023119826441</a></p>
<p>Bell, A., &amp; Jones, K. (2015). Explaining fixed effects: Random
effects modeling of time-series cross-sectional and panel data.
<em>Political Science Research and Methods</em>, <em>3</em>, 133–153. <a href="https://doi.org/10.1017/psrm.2014.7" class="external-link uri">https://doi.org/10.1017/psrm.2014.7</a></p>
<p>Giesselmann, M., &amp; Schmidt-Catran, A. W. (2020). Interactions in
fixed effects regression models. <em>Sociological Methods &amp;
Research</em>, 1–28. <a href="https://doi.org/10.1177/0049124120914934" class="external-link uri">https://doi.org/10.1177/0049124120914934</a></p>
<p>McNeish, D. (2019). Effect partitioning in cross-sectionally
clustered data without multilevel models. <em>Multivariate Behavioral
Research</em>, Advance online publication. <a href="https://doi.org/10.1080/00273171.2019.1602504" class="external-link uri">https://doi.org/10.1080/00273171.2019.1602504</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jacob A. Long.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
